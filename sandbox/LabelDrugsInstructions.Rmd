

GOALS:
* Get more familiar with R and with the resources available
* Identify which studies (and then samples) have drugs in them


Work through the R Tutorial:
https://www.datacamp.com/courses/free-introduction-to-r 

Packages to install
* tidyverse
* stringr


Read in the DrugBank labels - downloaded from https://www.drugbank.ca/releases/latest#open-data
```{r}
drugbank <- read.csv("data/drugbank_vocabulary.csv")
# look at the options for read.csv using ?read.csv
```

Read in the annotated data - this is the result of my meta-analysis annotations
```{r}
annot_data <- read.delim("data/annot_data_drug.tsv")
# look at the options for read.delim using ?read.delim
# why are we using read.delim here?
```


Descriptive analysis of the data
```{r}
# From the annotated data: select the column "drug_exposure" using df[,"col.name"]

# Then use the function table() to count the number of drug exposures (FALSE, TRUE)
# - How many drug exposures are there? 


# For the drugbank data
#  - how many rows are in the data?
#  - how many columns are in the data?
#  use ncol, nrow, and dim to do this


```



Extract the title column from the annotated data, separate titles into words
Extract column using df[,"col.name"] -OR- df$col.name and save as a list
```{r}
list.titles <- # fill this in the with column

# check the class using "class()"

# if it is a factor, convert to character using "as.character()", double check the class
# ex. list.titles <- as.character(list.titles)
  
# convert these all to lower case using str_to_lower()

### create a bag of words for each title ###
# (note - we don't use this for now, but it's worth doing just as an exercise)
# separate one title into a bag of words:
bag.words1 <- strsplit(list.titles[[1]], " ")
# look at the output - how long is it? which part do we want?
# play around with this
bag.words1
length(bag.words1)
length(bag.words1[[1]]) # what is this?
str_length(bag.words1[[1]][[1]])

# run this command to separate all titles into words 
# - sapply takes a function and applies it to every item in a list
# - look this up, make sure you understand what it is doing
# - why did 
all.bags.words <- sapply(list.titles, function(title){
  str_split(title[[1]], " ")[[1]]
})
```


Look at tylenol information
```{r}
# Look at Common.name, Synonym in drugbank
# check the class using "class()"

# if it is a factor, convert to character using "as.character()", then double check the class
# ex. drugbank$Common.name <- as.character(drugbank$Common.Name)

# Extract the row that has "Acetaminophen" as the common name
#  using df[df$Common.name=="<desired_drug>",] (where df is drugbank data frame, and you fill in desired drug)
tylenol.row <- 
  
# what is the common.name? store this:
tylenol.name <-

# what is the drugbank ID? store this:
tylenol.drugbank.id <- 

# split the synonym column
tylenol.synonyms <- strsplit(tylenol.row[,"Synonyms"], " \\| ")[[1]] 
# compare this to the str_split command used above - how does this differ?
# How many synonyms are there? use length()

# put together the lists
list.tylenol <- c(tylenol.name, tylenol.synonyms)

# combine this into a regular expression - "|" is OR
tylenol.str <- paste(list.tylenol, collapse="|")

# convert all the drug names to lower case using "str_to_lower()"  

```


Look for tylenol in all the titles:
```{r}

# first way - see if it is in any of the data frames
str_detect(list.titles, tylenol.str.lower)

# How many results do we find? 

# Look at the results - which of these are the common name? a synonym?
# Which would we have missed if it was case sensitive?

# Add a column to the annotated data frame with the title "is.tylenol"


# make sure that we are using the lowercase lists! double check this
```



Select the column with Common.name from drugbank data 
Save this as a list.

For labeling all drugs, try writing a function in R that takes input of a single title and then selects the drug label.
  you can either use str_detect -OR- I recommend trying intersect() and making the title into a bag of words too

```{r}
list.drugs <- drugbank$Common.name # make sure the elements are characters and it is lowercase

idDrugInTitle(title, list.drugs){
  # make title into a bag of words - like we did before

  # look for the intersection with list.drugs
  # use the function intersect()
  
  # "Acetaminophen"

  # return NA if no drugs present
  # or a string of the drugs that intersect
  #  format the string as "drugA" if it's one drug, or  "drugA | drugB" etc if it's multiple 
  # use paste() to format the string
}
```

Test this on a couple examples
* try acetaminophen - do you get the same results?
* pick another drug (e.g. doxorubicin) - inspect the results manually - do they make sense?

Then structure it like a for loop:
* We will speed this up later, but just do it how you'd think it thru programmatically and we can always do that later

```{r}
#  for (title in list.titles){
#    drug.label <- idDrugInTitle(title, list.drugs)
# }

drugsAll <- paste(drugsInStudy, collapse=" | ")
```   

title <- list.titles[[1]]
bagWordsTitlke

* How many drug exposures do we identify?
* Create a column that lists which drugs are present

```{r}
drug.labels <- sapply(head(list.titles), function(title) idDrugInTitle(title, list.drugs))
sapply(list.of.items, function(item, args))
```

Search for the synonyms 
* Note that you will have to parse the synonym column 
* In the end, the label in the drug column should be the drug name, not the synonym
* How many more does this get? Is it helpful?

```{r}

```

Descriptive analysis of the results:
* how many drugs? which drugs?
* make a bar chart of frequencies of drugs present more than once
https://www.statmethods.net/graphs/bar.html

```{r}

```

